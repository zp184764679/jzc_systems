# ç¯å¢ƒé…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®æ”¯æŒ**å¼€å‘ç¯å¢ƒ**å’Œ**ç”Ÿäº§ç¯å¢ƒ**çš„é…ç½®åˆ†ç¦»ï¼Œç¡®ä¿ä¸¤ä¸ªç¯å¢ƒäº’ä¸å¹²æ‰°ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Windows ç³»ç»Ÿ (å¼€å‘ç¯å¢ƒ)                       â”‚
â”‚                                                          â”‚
â”‚  å¼€å‘å·¥å…·:                                                â”‚
â”‚  â€¢ Vite å¼€å‘æœåŠ¡å™¨ (çƒ­é‡è½½)                                â”‚
â”‚  â€¢ Flask å¼€å‘æœåŠ¡å™¨ (DEBUGæ¨¡å¼)                            â”‚
â”‚  â€¢ localhost è®¿é—®                                         â”‚
â”‚                                                          â”‚
â”‚  é…ç½®æ–‡ä»¶: .env.development                               â”‚
â”‚  åˆ‡æ¢å‘½ä»¤: backend\åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ.bat                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
              å…±äº« MySQL æ•°æ®åº“
                (localhost:3306)
                        â†‘
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               WSL ç³»ç»Ÿ (ç”Ÿäº§ç¯å¢ƒ)                          â”‚
â”‚                                                          â”‚
â”‚  ç”Ÿäº§æœåŠ¡:                                                â”‚
â”‚  â€¢ Nginx (åå‘ä»£ç† + é™æ€æ–‡ä»¶)                             â”‚
â”‚  â€¢ Gunicorn (å¤šè¿›ç¨‹ WSGI æœåŠ¡å™¨)                          â”‚
â”‚  â€¢ Supervisor (è¿›ç¨‹å®ˆæŠ¤)                                  â”‚
â”‚  â€¢ å…¬ç½‘ IP è®¿é—®                                           â”‚
â”‚                                                          â”‚
â”‚  é…ç½®æ–‡ä»¶: .env.production                                â”‚
â”‚  éƒ¨ç½²è„šæœ¬: è¿ç»´å·¥å…·/ç”Ÿäº§éƒ¨ç½²/wsl-deploy.sh                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ .env                        å½“å‰ä½¿ç”¨çš„é…ç½®ï¼ˆä¸æäº¤gitï¼‰
â”œâ”€â”€ .env.development            å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.production             ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.backup                 è‡ªåŠ¨å¤‡ä»½
â”œâ”€â”€ åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ.bat           Windowsç¯å¢ƒåˆ‡æ¢è„šæœ¬
â””â”€â”€ åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ.bat           Windowsç¯å¢ƒåˆ‡æ¢è„šæœ¬
```

---

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### ç‰¹ç‚¹
- **è¿è¡Œå¹³å°**: Windows
- **æœåŠ¡å™¨**: Vite Dev Server + Flask Dev Server
- **è®¿é—®åœ°å€**: localhost
- **çƒ­é‡è½½**: âœ… æ”¯æŒ
- **è°ƒè¯•æ¨¡å¼**: âœ… å¼€å¯
- **ä¼ä¸šå¾®ä¿¡**: âš ï¸  æœ¬åœ°æ— æ³•æµ‹è¯•å›è°ƒ

### é…ç½®å†…å®¹ (.env.development)

```env
# ç¯å¢ƒæ ‡è¯†
FLASK_ENV=development
FLASK_DEBUG=True

# æ•°æ®åº“ - æœ¬åœ°
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=exak472008
DB_NAME=caigou

# Redis - æœ¬åœ°
CELERY_BROKER_URL=redis://localhost:6379/0

# å‰åç«¯åœ°å€ - æœ¬åœ°
WEWORK_H5_DOMAIN=http://localhost:3000
BACKEND_DOMAIN=http://localhost:5001

# è·¨åŸŸ
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=DEBUG
```

### åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ

**Windows:**
```batch
# æ–¹æ³•1: åŒå‡»è¿è¡Œ
backend\åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ.bat

# æ–¹æ³•2: æ‰‹åŠ¨å¤åˆ¶
cd backend
copy /Y .env.development .env
```

**WSL/Linux:**
```bash
cd backend
cp .env.development .env
```

### å¯åŠ¨å¼€å‘ç¯å¢ƒ

```batch
# ä½¿ç”¨å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰
è¿ç»´å·¥å…·\å¯åŠ¨é‡‡è´­ç³»ç»Ÿ.bat

# æˆ–æ‰‹åŠ¨å¯åŠ¨
cd backend
python app.py

cd frontend
npm start
```

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒé…ç½®

### ç‰¹ç‚¹
- **è¿è¡Œå¹³å°**: WSL / Linux
- **æœåŠ¡å™¨**: Nginx + Gunicorn (å¤šè¿›ç¨‹)
- **è®¿é—®åœ°å€**: å…¬ç½‘IP (61.145.212.28)
- **çƒ­é‡è½½**: âŒ éœ€è¦é‡å¯
- **è°ƒè¯•æ¨¡å¼**: âŒ å…³é—­
- **ä¼ä¸šå¾®ä¿¡**: âœ… å®Œå…¨æ”¯æŒ

### é…ç½®å†…å®¹ (.env.production)

```env
# ç¯å¢ƒæ ‡è¯†
FLASK_ENV=production
FLASK_DEBUG=False

# æ•°æ®åº“ - å½“å‰å…±ç”¨Windowsï¼Œæœªæ¥ç‹¬ç«‹
DB_HOST=172.24.x.x              # WSLè®¿é—®Windowsçš„IP
DB_PORT=3306
DB_USER=root
DB_PASSWORD=exak472008
DB_NAME=caigou

# Redis - æœ¬åœ°
CELERY_BROKER_URL=redis://localhost:6379/0

# å‰åç«¯åœ°å€ - å…¬ç½‘
WEWORK_H5_DOMAIN=http://61.145.212.28:3000
BACKEND_DOMAIN=http://61.145.212.28:5001

# è·¨åŸŸï¼ˆä¸¥æ ¼æ§åˆ¶ï¼‰
CORS_ORIGINS=http://61.145.212.28:3000

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=INFO

# Gunicorné…ç½®
GUNICORN_WORKERS=4
GUNICORN_THREADS=2
GUNICORN_BIND=0.0.0.0:5001
```

### åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

**Windows (ä»…é…ç½®ï¼Œä¸å¯åŠ¨):**
```batch
backend\åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ.bat
```

**WSL (é…ç½® + éƒ¨ç½²):**
```bash
# ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
cd /mnt/c/Users/Admin/Desktop/é‡‡è´­/è¿ç»´å·¥å…·/ç”Ÿäº§éƒ¨ç½²
chmod +x wsl-deploy.sh
./wsl-deploy.sh

# æˆ–æ‰‹åŠ¨åˆ‡æ¢
cd ~/caigou-system/backend
cp .env.production .env
```

### å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨Supervisorï¼ˆè‡ªåŠ¨å¯åŠ¨ï¼‰
sudo supervisorctl start caigou-backend
sudo supervisorctl start caigou-celery

# æ‰‹åŠ¨å¯åŠ¨Gunicornï¼ˆä¸æ¨èï¼‰
cd ~/caigou-system/backend
source venv/bin/activate
gunicorn -c gunicorn_config.py app:app
```

---

## ğŸ”„ ç¯å¢ƒåˆ‡æ¢æµç¨‹

### å¼€å‘ â†’ ç”Ÿäº§

```bash
# 1. æäº¤ä»£ç 
git add .
git commit -m "æ›´æ–°ä»£ç "
git push

# 2. åœ¨WSLä¸­æ‹‰å–
cd ~/caigou-system
git pull

# 3. åˆ‡æ¢é…ç½®
cd backend
cp .env.production .env

# 4. æ›´æ–°ä¾èµ–
source venv/bin/activate
pip install -r requirements.txt

# 5. æ„å»ºå‰ç«¯
cd ../frontend
npm install
npm run build

# 6. é‡å¯æœåŠ¡
sudo supervisorctl restart caigou-backend
sudo supervisorctl restart caigou-celery
sudo systemctl reload nginx
```

### ç”Ÿäº§ â†’ å¼€å‘

```batch
REM 1. åˆ‡æ¢é…ç½®
cd backend
backend\åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ.bat

REM 2. å¯åŠ¨å¼€å‘æœåŠ¡
è¿ç»´å·¥å…·\å¯åŠ¨é‡‡è´­ç³»ç»Ÿ.bat
```

---

## âš™ï¸ é…ç½®å·®å¼‚å¯¹æ¯”

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|---------|---------|
| è¿è¡Œå¹³å° | Windows | WSL/Linux |
| æœåŠ¡å™¨ | Flask Dev | Gunicorn |
| å‰ç«¯ | Vite Dev | Nginxé™æ€ |
| è®¿é—®åœ°å€ | localhost | 61.145.212.28 |
| æ•°æ®åº“åœ°å€ | localhost | 172.24.x.x |
| DEBUGæ¨¡å¼ | âœ… | âŒ |
| çƒ­é‡è½½ | âœ… | âŒ |
| æ—¥å¿—çº§åˆ« | DEBUG | INFO |
| è·¨åŸŸ | å®½æ¾ | ä¸¥æ ¼ |
| ä¼ä¸šå¾®ä¿¡å›è°ƒ | âŒ | âœ… |
| è¿›ç¨‹å®ˆæŠ¤ | æ—  | Supervisor |
| åå‘ä»£ç† | æ—  | Nginx |

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### å½“å‰é˜¶æ®µï¼šå…±äº«MySQL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Windows   â”‚
â”‚             â”‚
â”‚  MySQL      â”‚â—„â”€â”€â”€â”€ å¼€å‘ç¯å¢ƒç›´æ¥è¿æ¥ (localhost:3306)
â”‚  :3306      â”‚
â”‚             â”‚â—„â”€â”€â”€â”€ ç”Ÿäº§ç¯å¢ƒé€šè¿‡IPè¿æ¥ (172.24.x.x:3306)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**WSLè®¿é—®Windows MySQLæ­¥éª¤ï¼š**

1. è·å–Windows IP:
```bash
ip route show | grep -i default | awk '{ print $3}'
# è¾“å‡ºä¾‹å¦‚: 172.24.208.1
```

2. ä¿®æ”¹ç”Ÿäº§é…ç½®:
```env
DB_HOST=172.24.208.1
```

3. MySQLæˆæƒ:
```sql
GRANT ALL PRIVILEGES ON caigou.* TO 'root'@'172.24.%' IDENTIFIED BY 'exak472008';
FLUSH PRIVILEGES;
```

### æœªæ¥éƒ¨ç½²ï¼šç‹¬ç«‹MySQL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Windows   â”‚      â”‚   ç”Ÿäº§æœåŠ¡å™¨  â”‚
â”‚             â”‚      â”‚             â”‚
â”‚  MySQL Dev  â”‚      â”‚  MySQL Prod â”‚
â”‚  :3306      â”‚      â”‚  :3306      â”‚
â”‚             â”‚      â”‚             â”‚
â”‚  (å¼€å‘æ•°æ®)  â”‚      â”‚  (ç”Ÿäº§æ•°æ®)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿ç§»æ­¥éª¤ï¼š**

1. å¯¼å‡ºæ•°æ®:
```bash
mysqldump -u root -pexak472008 caigou > caigou_backup.sql
```

2. ä¿®æ”¹ç”Ÿäº§é…ç½®:
```env
DB_HOST=prod-mysql-server.com
DB_PORT=3306
DB_USER=caigou_prod_user
DB_PASSWORD=strong_password_here
DB_NAME=caigou
```

3. å¯¼å…¥æ•°æ®:
```bash
mysql -h prod-mysql-server.com -u caigou_prod_user -p caigou < caigou_backup.sql
```

---

## ğŸ” å®‰å…¨å»ºè®®

### å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨ç®€å•å¯†ç ï¼ˆä»…æœ¬åœ°ï¼‰
- âœ… DEBUGæ¨¡å¼å¼€å¯
- âœ… è¯¦ç»†é”™è¯¯ä¿¡æ¯
- âš ï¸  ä¸è¦æš´éœ²åˆ°å…¬ç½‘

### ç”Ÿäº§ç¯å¢ƒ
- âŒ ç»ä¸ä½¿ç”¨å¼±å¯†ç 
- âŒ å…³é—­DEBUGæ¨¡å¼
- âœ… ä½¿ç”¨HTTPSï¼ˆSSLè¯ä¹¦ï¼‰
- âœ… é…ç½®é˜²ç«å¢™
- âœ… é™åˆ¶æ•°æ®åº“è®¿é—®IP
- âœ… å®šæœŸå¤‡ä»½æ•°æ®
- âœ… ç›‘æ§æ—¥å¿—å’Œæ€§èƒ½

---

## ğŸ“ ç¯å¢ƒå˜é‡æ¸…å•

### å¿…éœ€é…ç½®
- `FLASK_ENV`: ç¯å¢ƒæ ‡è¯† (development/production)
- `DB_HOST`: æ•°æ®åº“åœ°å€
- `DB_PASSWORD`: æ•°æ®åº“å¯†ç 
- `BACKEND_DOMAIN`: åç«¯åŸŸå
- `WEWORK_H5_DOMAIN`: å‰ç«¯åŸŸå

### å¯é€‰é…ç½®
- `LOG_LEVEL`: æ—¥å¿—çº§åˆ«
- `CELERY_WORKER_CONCURRENCY`: Celeryå¹¶å‘æ•°
- `GUNICORN_WORKERS`: Gunicornè¿›ç¨‹æ•°

### æ•æ„Ÿé…ç½®ï¼ˆä¸è¦æäº¤gitï¼‰
- `APP_SECRET`: åº”ç”¨å¯†é’¥
- `DB_PASSWORD`: æ•°æ®åº“å¯†ç 
- `WEWORK_SECRET`: ä¼ä¸šå¾®ä¿¡å¯†é’¥
- `WECHAT_APPSECRET`: å¾®ä¿¡å¯†é’¥

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: åˆ‡æ¢ç¯å¢ƒåæœåŠ¡æ— æ³•å¯åŠ¨ï¼Ÿ
**A:** ç¡®ä¿ï¼š
1. å·²é‡å¯æœåŠ¡
2. é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®
3. ç«¯å£æ²¡æœ‰è¢«å ç”¨

### Q2: WSLæ— æ³•è¿æ¥Windowsçš„MySQLï¼Ÿ
**A:** æ£€æŸ¥ï¼š
1. Windowsé˜²ç«å¢™æ˜¯å¦å…è®¸3306
2. MySQLæ˜¯å¦å…è®¸è¿œç¨‹è¿æ¥
3. IPåœ°å€æ˜¯å¦æ­£ç¡®

### Q3: ä¼ä¸šå¾®ä¿¡å›è°ƒå¤±è´¥ï¼Ÿ
**A:** åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼ä¸šå¾®ä¿¡å›è°ƒæ— æ³•å·¥ä½œï¼Œéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ã€‚

### Q4: ç”Ÿäº§ç¯å¢ƒä¿®æ”¹ä»£ç ä¸ç”Ÿæ•ˆï¼Ÿ
**A:** ç”Ÿäº§ç¯å¢ƒéœ€è¦é‡å¯æœåŠ¡ï¼š
```bash
sudo supervisorctl restart caigou-backend
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [WSLéƒ¨ç½²æŒ‡å—](./WSLéƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
- [å¿«é€Ÿå¯åŠ¨æŒ‡å—](../../å¿«é€Ÿå¯åŠ¨.txt) - å¿«é€Ÿå…¥é—¨
- [è¿ç»´å·¥å…·ä½¿ç”¨æŒ‡å—](../README.txt) - å·¥å…·è¯´æ˜

---

**æœ€åæ›´æ–°ï¼š2025-01-08**
