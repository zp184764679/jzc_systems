# 📊 报价公式完整分析

## 🎯 顶层结构

```
N 单价 = A + M
       = 2.4419 + 0.3663
       = 2.8082 元/件
```

### 核心组成
- **A 小计单价** = B + C + D + F = 2.4419元
- **M 利润** = A × 15% = 0.3663元

---

## 📋 费用分类明细

### Ａ 小计单价 = Ｂ + Ｃ + Ｄ + F

```
A = 0.6047 + 1.3756 + 0.1396 + 0.322 = 2.4419
    ↓       ↓        ↓        ↓
    B材料费  C加工费   D管理费   F其他费
```

---

## 🔧 B 材料费（Material Cost）

### 公式
```
B = E × 材料单价 × 总不良率系数 × 材管率系数 ÷ 1000

其中：
E重量(g) = π × (外径)²/4 × 材料长度 ÷ 取数 × 比重
```

### 实例计算
```
材料参数：
- 外径：8.05 mm
- 材料长度：2500 mm
- 产品长：256.5 mm
- 切口：2.5 mm
- 残材：160 mm
- 取数：Int[(2500-160)/(256.5+2.5)] = 9
- 比重：0.0079 g/cm³

E重量 = π × (8.05)²/4 × 2500 ÷ 9 × 0.0079 = 111.69 g

B材料费 = 111.69 × 5.1 × 1.0306 × 1.03 ÷ 1000 = 0.6047 元
```

### 可调参数
| 参数 | 说明 | 示例值 |
|------|------|--------|
| outer_diameter | 外径(mm) | 8.05 |
| material_length | 材料长度(mm) | 2500 |
| product_length | 产品长(mm) | 256.5 |
| cut_width | 切口(mm) | 2.5 |
| remaining_material | 残材(mm) | 160 |
| material_density | 比重(g/cm³) | 0.0079 |
| material_price | 材料单价(元/kg) | 5.1 |
| total_defect_rate | 总不良率(%) | 3.06 |
| material_mgmt_rate | 材管率(%) | 3 |

---

## ⚙️ C 加工费（Processing Cost）

### 公式
```
C = Σ(各工序加工费)

工序加工费 = (加工日数 + 段取时间) × 工事费/日 ÷ LOT

加工日数 = 加工个数 ÷ 日产
加工个数 = LOT × (1 + 不良率/100)
```

### 实例：工序明细

| 序号 | 工序名称 | 不良率% | 加工个数 | 日产 | 加工日数 | 段取时间 | 工事费/日 | LOT | 加工费 |
|------|----------|---------|----------|------|----------|----------|-----------|-----|--------|
| 1 | CNC车削 | 1.0 | 1030.6 | 480 | 2.147 | 0.125 | 400 | 1000 | 0.9088 |
| 2 | 铣扁 | 1.0 | 1020.3 | 1500 | 0.680 | 0.125 | 0 | 1000 | 0.0000 |
| 3 | 机动去披锋 | 0.0 | 1010.1 | 1500 | 0.673 | 0.125 | 0 | 1000 | 0.0000 |
| 4 | 手工去披锋 | 0.0 | 1010.1 | 3000 | 0.337 | 0.125 | 0 | 1000 | 0.0000 |
| 5 | 无芯磨 | 0.0 | 1010.1 | 3000 | 0.337 | 0.125 | 200 | 1000 | 0.0923 |
| 6 | 检查费 | 0.0 | 1010.1 | 3000 | 0.337 | 0.125 | 100 | 1000 | 0.0462 |
| 8 | 电镀费 | 1.0 | 1010.1 | 特殊 | - | - | 0.3242/件 | 1000 | 0.3275 |
| 11 | 梱包加工 | 0.2 | - | - | 0.2箱时 | - | 8/时 | 2000入/箱 | 0.0008 |

**C加工費总计** = 1.3756 元

### 可调参数（每个工序）
| 参数 | 说明 | 单位 |
|------|------|------|
| process_name | 工序名称 | - |
| defect_rate | 不良率 | % |
| daily_output | 日产 | 个/天 |
| setup_time | 段取时间 | 天 |
| daily_fee | 工事费/日 | 元/天 |

---

## 📊 D 管理费（Management Cost）

### 公式
```
D = 一般管理费 + H运送费

一般管理费 = C加工费 × 管理费率%
H运送费 = 基础运费 ÷ 箱数 ÷ 入数 ÷ 积载率
```

### 实例计算
```
一般管理费 = 1.3756 × 10% = 0.1376 元

H运送费 = 200 ÷ 60 ÷ 80 ÷ 20 = 0.00208 元

D管理费 = 0.1376 + 0.00208 = 0.1396 元
```

### 可调参数
| 参数 | 说明 | 示例值 |
|------|------|--------|
| management_rate | 管理费率 | 10% |
| base_shipping_cost | 基础运费 | 200元 |
| num_boxes | 箱数 | 60 |
| pieces_per_box | 每箱入数 | 80 |
| loading_rate | 积载率 | 20 |

---

## 📦 F 其他费用（Other Costs）

### 公式
```
F = 包装材料费 + 消耗品费
```

### 包装材料费明细
```
一Lot包装材料费：
- ビニール袋：0.25 × 4个 = 1.0元
- Carton：1.5 × 60个 = 90.0元
- 纸箱：1.8 × 125个 = 225.0元
合计：316.0元

单件包装材料费 = 316 ÷ 1000 = 0.316 元/件
```

### 实例计算
```
F = 0.316 + 0.006 = 0.322 元
```

### 可调参数
| 参数 | 说明 | 示例值 |
|------|------|--------|
| packaging_cost | 包装材料费 | 0.316 元/件 |
| consumables_cost | 消耗品费 | 0.006 元/件 |

---

## 💰 M 利润（Profit）

### 公式
```
M = A小计单价 × 利润率%
```

### 实例计算
```
M = 2.4419 × 15% = 0.3663 元
```

### 可调参数
| 参数 | 说明 | 示例值 |
|------|------|--------|
| profit_rate | 利润率 | 15% |

---

## 🎯 完整参数汇总

### 第一层级：基础图纸参数（OCR自动识别）
- 外径、长度、材质、客户名称、图号等

### 第二层级：材料计算参数
- 材料长度、产品长、切口、残材、取数
- 材料单价、比重、材管率

### 第三层级：工艺参数（可编辑表格）
- 每个工序的不良率、日产、段取时间、工事费

### 第四层级：成本率参数
- 总不良率、管理费率、利润率

### 第五层级：其他费用参数
- 运送费参数（基础运费、箱数、入数、积载率）
- 包装费、消耗品费

---

## 💡 界面重构建议

### 分区方案

```
┌─────────────────────────────────────────┐
│  📋 基本信息（图号、客户、材质、尺寸）    │
├─────────────────────────────────────────┤
│  🔧 材料成本计算区                       │
│  ├─ 材料参数（长度、取数、单价...）      │
│  └─ 实时计算显示：B材料费 = X.XX元      │
├─────────────────────────────────────────┤
│  ⚙️ 工艺流程配置                         │
│  ├─ 工序选择网格                         │
│  └─ 工序明细表（可编辑）                 │
│     实时计算显示：C加工费 = X.XX元       │
├─────────────────────────────────────────┤
│  📊 管理费配置                           │
│  ├─ 管理费率、运送费参数                 │
│  └─ 实时计算显示：D管理费 = X.XX元      │
├─────────────────────────────────────────┤
│  📦 其他费用                             │
│  ├─ 包装费、消耗品费                     │
│  └─ 实时计算显示：F其他费 = X.XX元      │
├─────────────────────────────────────────┤
│  💰 利润设置                             │
│  ├─ 利润率                               │
│  └─ 实时计算显示：M利润 = X.XX元        │
├─────────────────────────────────────────┤
│  🎯 报价结果汇总                         │
│  A小计 = B+C+D+F = X.XX                 │
│  N单价 = A+M = X.XX                      │
│  总金额 = N × 批量 = X.XX                │
└─────────────────────────────────────────┘
```

### 实时计算显示
每个费用分类右上角显示实时计算结果，让工程师随时了解各部分成本。

---

**分析完成时间**：2025-11-14
**Excel来源**：报价公式.xls
**公式版本**：LX长件报价单
