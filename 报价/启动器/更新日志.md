# 📝 启动器更新日志

## v2.1 - 2025-11-12

### 🎉 新增功能

#### 1. 外部进程检测
启动器现在可以检测到**外部启动的服务**，即使不是通过启动器启动的前后端，也能正确显示状态。

**状态显示：**
- ✓ 运行中 - 通过启动器启动的服务
- ✓ 运行中(外部) - 外部启动的服务
- ⚪ 已停止 - 服务未运行

#### 2. 端口占用保护
在启动服务前，会先检查端口是否已被占用，避免重复启动导致冲突。

**提示信息：**
```
警告：端口 8000 已被占用，前端可能已在运行
提示：如需重启，请先手动停止占用端口的进程
```

#### 3. 智能状态监控
改进了监控逻辑，优先通过端口检测服务状态，而不仅依赖进程对象。

**监控优先级：**
1. 首先检查服务端口是否可访问
2. 然后判断是否为启动器管理的进程
3. 最后显示对应的状态

---

### 🔧 技术改进

#### 修改的函数

##### 1. start_backend()
```python
# 新增端口检查
if self.check_port(8001):
    self.log("警告：端口 8001 已被占用，后端可能已在运行", "warning")
    self.log("提示：如需重启，请先手动停止占用端口的进程", "info")
    return
```

##### 2. start_frontend()
```python
# 新增端口检查
if self.check_port(8000):
    self.log("警告：端口 8000 已被占用，前端可能已在运行", "warning")
    self.log("提示：如需重启，请先手动停止占用端口的进程", "info")
    return
```

##### 3. monitor_services()
```python
# 改进监控逻辑 - 后端
if self.check_backend():
    # 服务在运行
    if self.processes['backend'] and self.processes['backend'].poll() is None:
        self.update_service_status('backend', 'running', '✓ 运行中')
    else:
        # 外部启动的服务
        self.update_service_status('backend', 'running', '✓ 运行中(外部)')
else:
    # 服务未运行
    if self.processes['backend'] and self.processes['backend'].poll() is None:
        self.update_service_status('backend', 'running', '⚠ 启动中...')
    else:
        self.update_service_status('backend', 'stopped', '⚪ 已停止')
```

---

### 📊 使用场景

#### 场景1：启动器启动的服务
```
用户操作：点击「启动所有服务」
启动器：检查端口 → 端口空闲 → 启动服务 → 显示「✓ 运行中」
结果：✅ 正常启动，完全由启动器管理
```

#### 场景2：外部已启动服务
```
用户操作：
  1. 手动在终端运行：npm run dev
  2. 打开启动器
启动器：检查端口 → 端口8000已占用 → 显示「✓ 运行中(外部)」
结果：✅ 正确识别外部服务，不会重复启动
```

#### 场景3：尝试重复启动
```
用户操作：
  1. 前端已在运行（外部或内部）
  2. 点击「启动前端」
启动器：检查端口 → 端口8000已占用 → 提示「端口已被占用」
结果：✅ 阻止重复启动，避免端口冲突
```

---

### ⚠️ 已知限制

#### 1. 无法停止外部进程
启动器只能停止**它自己启动的进程**。如果服务显示为"运行中(外部)"，点击"停止"按钮将无效。

**解决方法：**
需要手动停止外部进程：
```bash
# 查看占用端口的进程
netstat -ano | findstr ":8000"

# 停止进程（PowerShell）
Stop-Process -Id [进程ID] -Force
```

#### 2. 日志窗口限制
对于外部启动的服务，启动器无法捕获其日志输出。点击"查看日志"将显示空白。

**解决方法：**
- 在启动服务的终端查看日志
- 或使用启动器启动服务

---

### 💡 建议使用方式

#### 推荐做法
1. ✅ **统一使用启动器**：始终通过启动器启动前后端
2. ✅ **关闭前先停止**：关闭启动器前，点击"停止所有服务"
3. ✅ **查看状态**：启动前查看服务状态，避免重复启动

#### 不推荐做法
1. ❌ 混合使用：一部分服务用启动器，一部分手动启动
2. ❌ 强制启动：看到"端口占用"提示后仍尝试启动
3. ❌ 不查看状态：直接点击启动，不管服务是否已运行

---

### 🔄 状态显示说明

| 状态文本 | 说明 | 可操作 |
|---------|------|--------|
| ⚪ 已停止 | 服务未运行 | ✅ 可启动 |
| ⚠ 启动中... | 服务正在启动 | ⌛ 请等待 |
| ✓ 运行中 | 启动器管理的服务 | ✅ 可停止、查看日志 |
| ✓ 运行中(外部) | 外部启动的服务 | ❌ 无法停止和查看日志 |
| ✗ 离线 | 依赖服务未运行 | ⚠️ 需手动启动 |
| ✓ 在线 | 依赖服务正常 | ✅ 正常 |

---

### 📚 相关文档

- **端口配置说明：** `端口配置说明.md`
- **使用说明：** `使用说明-更新版.md`
- **快速参考：** `快速参考.txt`

---

## v2.0 - 2025-11-12

### 🎉 主要更新

1. **隐藏CMD窗口** - 前后端启动时不再显示黑色终端
2. **独立日志窗口** - 可分别查看前后端实时日志
3. **端口配置调整** - 前端8000，后端8001
4. **日志管理功能** - 支持清空、自动滚动

---

## v1.0 - 2025-11-11

### 🎉 首次发布

1. **基础功能** - 一键启动前后端
2. **服务状态监控** - 实时显示5个服务状态
3. **操作日志** - 显示启动器操作记录

---

**最后更新：** 2025-11-12
**当前版本：** v2.1
